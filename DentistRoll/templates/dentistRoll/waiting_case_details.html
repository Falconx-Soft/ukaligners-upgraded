{% extends 'base.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/radio-button.css' %}" />
{% endblock %}

{% block content %}
<div class="main_content_iner ">
    <div class="container-fluid p-0">
        <div class="row justify-content-center">
            <div class="col-lg-5">
                <div class="white_card card_height_100 mb_30">
                    <div class="white_card_header">
                        <div class="box_header m-0">
                            <div class="main-title">
                                <h3 class="m-0">Patient Details</h3>
                            </div>
                        </div>
                    </div>
                    <div class="white_card">
                        <div class="QA_section plr_30">
                            <div class="QA_table mb_30">
                                <table class="table ">
                                    <tbody>
                                        <tr>
                                            <td>Name</td>
                                            <td>{{case_obj.name}}</td>
                                        </tr>
                                        <tr>
                                            <td>Surname</td>
                                            <td>{{case_obj.surname}}</td>
                                        </tr>
                                        <tr>
                                            <td>Gender</td>
                                            <td>{{case_obj.gender}}</td>
                                        </tr>
                                        <tr>
                                            <td>Age</td>
                                            <td>{{case_obj.age}}</td>
                                        </tr>
                                        <tr>
                                            <td>Orthodontic treatment past</td>
                                            <td>{{case_obj.orthodontic_treatment_past}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="white_card_header">
                        <div class="box_header m-0">
                            <div class="main-title">
                                <h3 class="m-0">Treatment</h3>
                            </div>
                        </div>
                    </div>
                    <div class="white_card">
                        <div class="QA_section plr_30">
                            <div class="QA_table mb_30">
                                <table class="table ">
                                    <tbody>
                                        <tr>
                                            <td>Treatment required</td>
                                            <td>{{case_obj.treatment_required}}</td>
                                        </tr>
                                        <tr>
                                            <td>Optional treatment</td>
                                            <td>{{case_obj.optional_treatment}}</td>
                                        </tr>
                                        <tr>
                                            <td>Section</td>
                                            <td>{{case_obj.section}}</td>
                                        </tr>
                                        <tr>
                                            <td>Upper jaw</td>
                                            <td>
                                                {% if case_obj.upper_jaw %}
                                                <a href="{{case_obj.upper_jaw.url}}" target="_blank"
                                                    download>Download</a>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Lower jaw</td>
                                            <td>
                                                {% if case_obj.lower_jaw %}
                                                <a href="{{case_obj.lower_jaw.url}}" target="_blank"
                                                    download>Download</a>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Additional information</td>
                                            <td>{{case_obj.rquest_collection}}</td>
                                        </tr>
                                        <tr>
                                            <td>Rquest collection</td>
                                            <td>{{case_obj.rquest_collection}}</td>
                                        </tr>
                                        <tr>
                                            <td>Manager</td>
                                            {% if case_obj.dentist %}
                                            <td>{{case_obj.dentist.manager}}</td>
                                            {% else %}
                                            <td>{{case_obj.saloon_owner.manager}}</td>
                                            {% endif %}
                                        </tr>
                                        {% if request.user.is_admin %}
                                        <tr>
                                            <td>Planner</td>
                                            <td>{{case_obj.planner}}</td>
                                        </tr>
                                        <tr>
                                            <td>Technician</td>
                                            <td>{{case_obj.technician}}</td>
                                        </tr>
                                        {% endif %}
                                        <tr>
                                            <td>Status</td>
                                            <td>{{case_obj.status}}</td>
                                        </tr>
                                        <tr>
                                            <td>Created at</td>
                                            <td>{{case_obj.created_at}}</td>
                                        </tr>
                                        <tr>
                                            <td>Additional Images</td>
                                            <td>
                                                <div class="images-grid">
                                                    {% for image in additional_images_obj %}
                                                    <div class="image-holder">
                                                        <a href="{{ image.image.url }}" target="_blank" download>
                                                            <img src="{{image.image.url}}" class="image">
                                                        </a>
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-5">
                <div class="white_card card_height_100 mb_30">
                    <div class="white_card_header">
                        <div class="box_header m-0">
                            <div class="main-title">
                                <h3 class="m-0">Treatment</h3>
                            </div>
                        </div>
                    </div>
                    <div class="white_card">
                        <div class="QA_section plr_30">
                            <div class="QA_table mb_30">
                                <table class="table ">
                                    <tbody>
                                        <tr>
                                            <td>Ortho id</td>
                                            <td>{{case_obj.ortho_id}}</td>
                                        </tr>
                                        <tr>
                                            <td>Aligners upper</td>
                                            <td>{{case_obj.aligners_upper}}</td>
                                        </tr>
                                        <tr>
                                            <td>Aligners lower</td>
                                            <td>{{case_obj.aligners_lower}}</td>
                                        </tr>
                                        <tr>
                                            <td>Retainer upper</td>
                                            <td>{{case_obj.retainer_upper}}</td>
                                        </tr>
                                        <tr>
                                            <td>Retainer lower</td>
                                            <td>{{case_obj.retainer_lower}}</td>
                                        </tr>
                                        <tr>
                                            <td>Treatment plan upper</td>
                                            <td>{{case_obj.treatment_plan_upper}}</td>
                                        </tr>
                                        <tr>
                                            <td>Treatment plan lower</td>
                                            <td>{{case_obj.treatment_plan_lower}}</td>
                                        </tr>
                                        <tr>
                                            <td>Duration (Months)</td>
                                            <td>{{case_obj.duration}}</td>
                                        </tr>
                                        <tr>
                                            <td>Additional Videos</td>
                                            <td>
                                                <div class="download-video-div">
                                                    {% for video in additional_videos_obj %}
                                                    <a href="{{ video.video.url }}" target="_blank" download>
                                                        Download
                                                    </a>
                                                    {% endfor %}
                                                </div>
                                            </td>
                                        </tr>
                                        {% if case_obj.status == "accepted" %}

                                        <tr>
                                            <td>Progress</td>
                                            <td>{{case_obj.progress}}</td>
                                        </tr>

                                        <tr>
                                            <td>Treatment Type</td>
                                            <td>{{case_obj.treatment_type}}</td>
                                        </tr>

                                        <tr>
                                            <td>Status</td>
                                            <td>{{case_obj.status}}</td>
                                        </tr>

                                        {% else %}
                                        <form method="post">
                                            {% csrf_token %}
                                            {% if request.user.is_dentist %}
                                                <tr>
                                                    <td>Treatment type</td>
                                                    <td>
                                                        <div>
                                                            <div id="radio-cards-container">
                                                                <!-- Radio Card 1 -->
                                                                {% if case_obj.treatment_type == "essential" or not case_obj.treatment_type %}
                                                                <div class="radio-card radio-card-1 selected"
                                                                    onclick="selectRadioCard('1','essential')">
                                                                {% else %}
                                                                <div class="radio-card radio-card-1"
                                                                    onclick="selectRadioCard('1','essential')">
                                                                {% endif %}
                                                                    <!-- Radio Card Check (tick) icon. By default, its hidden. Will be displayed when card gets clicked. -->
                                                                    <div class="radio-card-check">
                                                                        <i class="fa-solid fa-check-circle"></i>
                                                                    </div>
                                                                    <!-- Section to display the icon, label, and some additional text -->
                                                                    <div class="text-center">
                                                                        <div class="radio-card-label">
                                                                            Treatment fee
                                                                        </div>
                                                                        <div class="radio-card-label-description">
                                                                            <table>
                                                                                <tbody>
                                                                                    <tr>
                                                                                        <td><b>Total:</b></td>
                                                                                        <td>{{total_amount_essential}}</td>
                                                                                    </tr>
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <!-- Radio Card 2 -->
                                                                {% if case_obj.treatment_type == "advance" %}
                                                                <div class="radio-card radio-card-2 selected"
                                                                    onclick="selectRadioCard('2','advance')">
                                                                {% else %}
                                                                <div class="radio-card radio-card-2"
                                                                    onclick="selectRadioCard('2','advance')">
                                                                {% endif %}
                                                                    <!-- Radio Card Check (tick) icon. By default, its hidden. Will be displayed when card gets clicked. -->
                                                                    <div class="radio-card-check">
                                                                        <i class="fa-solid fa-check-circle"></i>
                                                                    </div>
                                                                    <!-- Section to display the icon, label, and some additional text -->
                                                                    <div class="text-center">
                                                                        <div class="radio-card-label">
                                                                            Add on <br>
                                                                            Extensive
                                                                            <p>Control aligners changing time, even weekly
                                                                                patient can contact us directly with their questions
                                                                                40% discount on refinements
                                                                                Replacement of any damaged aligners directly through our monitoring system
                                                                                ossibility of patient to do IPR with our dentist via the system. 
                                                                                </p>
                                                                        </div>
                                                                        <div class="radio-card-label-description">
                                                                            <table>
                                                                                <tbody>
                                                                                    <tr>
                                                                                        <td><b>Total:</b></td>
                                                                                        <td>{{total_amount_advance}}</td>
                                                                                    </tr>
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <!-- Radio Card 3 -->
                                                                {% if case_obj.treatment_type == "comprehensive" %}
                                                                <div class="radio-card radio-card-3 selected"
                                                                    onclick="selectRadioCard('3','comprehensive')">
                                                                {% else %}
                                                                <div class="radio-card radio-card-3"
                                                                    onclick="selectRadioCard('3','comprehensive')">
                                                                {% endif %}
                                                                    <!-- Radio Card Check (tick) icon. By default, its hidden. Will be displayed when card gets clicked. -->
                                                                    <div class="radio-card-check">
                                                                        <i class="fa-solid fa-check-circle"></i>
                                                                    </div>
                                                                    <!-- Section to display the icon, label, and some additional text -->
                                                                    <div class="text-center">
                                                                        <div class="radio-card-label">
                                                                            Add on <br>
                                                                            Comperhensive
                                                                            <p>70% discount on refinements</p>
                                                                        </div>
                                                                        <div class="radio-card-label-description">
                                                                            <table>
                                                                                <tbody>
                                                                                    <tr>
                                                                                        <td><b>Total:</b></td>
                                                                                        <td>{{total_amount_comprehensive}}</td>
                                                                                    </tr>
                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            
                                            <tr>
                                                <td>Status</td>
                                                <td>
                                                    <select name="status" onchange="chk_status(this)" required>
                                                        <option value="">-----</option>

                                                        {% if case_obj.status == "accepted" %}
                                                        <option value="accepted" selected>accepted</option>
                                                        {% else %}
                                                        <option value="accepted">accepted</option>
                                                        {% endif %}

                                                        {% if case_obj.status == "declined" %}
                                                        <option value="declined" selected>declined</option>
                                                        {% else %}
                                                        <option value="declined">declined</option>
                                                        {% endif %}

                                                        {% if case_obj.status == "on-hold" %}
                                                        <option value="on-hold" selected>on-hold</option>
                                                        {% else %}
                                                        <option value="on-hold">on-hold</option>
                                                        {% endif %}

                                                        {% if case_obj.status == "review" %}
                                                        <option value="review" selected>review</option>
                                                        {% else %}
                                                        <option value="review">review</option>
                                                        {% endif %}
                                                    </select><br>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td></td>
                                                <td><button class="btn btn-primary mt-3 ms-2" type="submit"
                                                        value="Create">Update Status
                                                    </button></td>
                                            </tr>
                                            {% endif %}

                                            {% if case_obj.treatment_type %}
                                            <input type="hidden" value="{{case_obj.treatment_type}}" name="treatment_type" id="treatment-type">
                                            {% else %}
                                            <input type="hidden" value="essential" name="treatment_type" id="treatment-type">
                                            {% endif %}
                                        </form>
                                        {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


{% endblock %}

{% block js %}

<script>
    const selectRadioCard = (cardNo,type) => {
        /**
         * Loop through all radio cards, and remove the class "selected" from those elements.
         */
        const allRadioCards = document.querySelectorAll(".radio-card");
        allRadioCards.forEach((element, index) => {
            element.classList.remove(["selected"]);
        });
        /**
         * Add the class "selected" to the card which user has clicked on.
         */
        const selectedCard = document.querySelector(".radio-card-" + cardNo);
        selectedCard.classList.add(["selected"]);

        document.getElementById("treatment-type").value = type;
    };
</script>

<script>
    function chk_status(el){
        if(el.value == "accepted"){
            alert("You are going to accept the treatment which colud not be change");
        }
    }
</script>

{% endblock %}